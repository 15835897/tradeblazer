//------------------------------------------------------------------------
// ¼ò amp
// Ã³Æ amp
// À±ð«ʽӦÓ
// ÀÐ: Ó»§ӦÓ 
// Ê³ö/------------------------------------------------------------------------
Params
    Numeric Length1(3); 
    
     
Vars  
    NumericSeries amp(0);
    NumericSeries ma(0);
    Numeric highbar(0);
    Numeric lowbar(99999); 
    StringSeries strKey;
    Numeric i(0); 
    Numeric isup(0); 

    NumericSeries iAmplitude;
    String avgAmplitude;    
      
Begin 
 //   ma=Average(Close,Length1);
    /*
    If(Date!=Date[1] or CurrentBar==0)  
    {
        strKey = DateToString(Date[1]);
        amp=High-Low;
    }
    Else{
        amp=HighD[0]-LowD[0];
    }
    */

    //FileAppend("c:\\11b.log",Text(Year)+"."+Text(Month)+"."+Text(Day)+" "+Text(Time)+" "+"fffffffffffffff:"+Text(HighD(0)));

    
        // SetGlobalVar(1,1);
        // 1: ¼Ìø¸ßð// 2:Ð¸ß´̬Ç»»
        // 3:High
        // 4: Low
        
        // 5 :½ñǷñ­Ó¹ý»Ò
    
    If(Date!=Date[1])
    {
        strKey = DateToString(Date[1]);
        SetGlobalVar(3,0);
        SetGlobalVar(4,999999);

        SetGlobalVar(1,0);
        SetGlobalVar(5,0);

    }Else
    {
        strKey = strKey[1];
    }

    amp=HighD(0)-LowD(0); 
    isup=CloseD(0) - OpenD(0);
    //isup=-111;
    FileAppend("c:\\h.log",Text(Year)+"."+Text(Month)+"."+Text(Day)+" "+Text(Time)+" "+"LowD111111111:"+Text(isup));

    /*
    //ֻ×ÈÅ£¬±£Á
    If(Time>0.09 and time<0.16)
    {
        If(High>GetGlobalVar(3))
        {
            //highbar=High;
            SetGlobalVar(3,High);
        }
        If(Low<GetGlobalVar(4))
        {
            SetGlobalVar(4,Low);
            //lowbar=Low;
        }
        //FileAppend("c:\\h.log",Text(date)+"123123123..."+Text(GetGlobalVar(3)));
        //FileAppend("c:\\h.log",Text(date)+"12312313123..."+Text(GetGlobalVar(4)));
        //FileAppend("c:\\h.log",Text(date)+"low..."+Text(Low));

        amp=GetGlobalVar(3)-GetGlobalVar(4);
    }
    */
    
    avgAmplitude = GetTBProfileString("Amplitude",strKey);
    //ÉһÌµÄ0Èƽ¾ù
    If(avgAmplitude != InvalidString)
    {
        iAmplitude = Value(avgAmplitude);
    }Else
    {
        iAmplitude = iAmplitude[1]; 
    } 
      
    If(amp>iAmplitude*0.7)
    {
        If(GetGlobalVar(1)==0)
        {
        
            If(Time>0.14)
            {
                Return;
            }
            
            if(isup>0 and GetGlobalVar(5)==0)  //Õ·ùÕ·½Ï
            {
                FileAppend("c:\\h.log",Text(Year)+"."+Text(Month)+"."+Text(Day)+" "+Text(Time)+" "+"CloseD:"+Text(CloseD(0)));
                FileAppend("c:\\h.log",Text(Year)+"."+Text(Month)+"."+Text(Day)+" "+Text(Time)+" "+"LowD:"+Text(LowD(0)));

                If(MarketPosition==0 )
                {
                    Buy(1,0);
                    //SellShort(1,0);
                    //SetGlobalVar(5,1);
                }
            }
            else If(isup<0 and GetGlobalVar(5)==0)  //Õ·ùµø
            {
                /////////////////////////////////////////////¿ªʼÂÈ////////////////////////////////////////////
                        
                FileAppend("c:\\h.log",Text(Year)+"."+Text(Month)+"."+Text(Day)+" "+Text(Time)+" "+"CloseD:"+Text(CloseD(0)));
                FileAppend("c:\\h.log",Text(Year)+"."+Text(Month)+"."+Text(Day)+" "+Text(Time)+" "+"OpenD:"+Text(LowD(0)));     
                If(MarketPosition==0)
                {
                    //Buy(1,0);
                    SellShort(1,0);
                    //SetGlobalVar(5,1);

                    //Buy(1,0);
                }
                /*else If(MarketPosition==1) // Ó¶àµÄé
                {
                    While(CurrentEntries < 4 && High >= LastPrice + AddSet*MinPoint) // ¼ӲÖ                 {
                        LastPrice = LastPrice + AddSet*MinPoint;
                        if(Open > LastPrice) LastPrice = Open;
                        Buy(1,LastPrice);
                    }

                    While(CurrentEntries > 0 && Low <= firstPrice - SubSet*MinPoint) // ¼õ                  {
                        firstPrice = firstPrice - SubSet*MinPoint;
                        if(Open < firstPrice) firstPrice = Open;
                        Sell(1,firstPrice);
                    }
                }
                */
            /////////////////////////////////////////////ÂÈ½á////////////////////////////////////////////
            }
            FileAppend("c:\\h.log",Text(Year)+"."+Text(Month)+"."+Text(Day)+" "+Text(Time)+" "+"Õ·ù20Èƽ¾ùµã:"+Text(amp-iAmplitude));
            SetGlobalVar(1,1);
            SetGlobalVar(2,amp);
        }
        Else If(GetGlobalVar(1)==1)
        {
            If(GetGlobalVar(2)<amp)
            {
                FileAppend("c:\\h.log",Text(Year)+"."+Text(Month)+"."+Text(Day)+" "+Text(Time)+" "+"Õ·ù¼Ìø:"+Text(amp-iAmplitude));
                //SetGlobalVar(1,2);
                SetGlobalVar(2,amp);
            }
            //else if(CloseD(0)>OpenD(0) and GetGlobalVar(5)==0)  //Õ·ùÕ·½Ï
            //else
        }
    }
     
    //ÊÅƽ²Ö /*
    If((Date[-1]!=InvalidInteger && Date!=Date[-1])||(Date[-1]==InvalidInteger && Date < CurrentDate))
    {
        Sell(0,Close);
        BuyToCover(0,Close);
    }Else 
    */
    //If(Date==CurrentDate && Time==0.1455 && CurrentTime>=0.1459)
    
    If(MarketPosition==1) // Ó¶àµÄé
    {
        If(Close<EntryPrice-50 or Time>0.1455 or Close>EntryPrice+200)
        {
            Sell(1,0);
            SetGlobalVar(5,1);
        }
    }
    else if(MarketPosition==-1) // Ó¿ղֵÄé
    {
        If(Close>EntryPrice+50 or Time>0.1455 or Close<EntryPrice-200)
        {
            BuyToCover(1,0);
            SetGlobalVar(5,1);
        }
    }
    
    
    /*
    If(MarketPosition<>0)
    {
        If(EntryPrice
        
        If(Time>0.1455 )
        {
            If(MarketPosition==1) // Ó¶àµÄé
            {
                Sell(1,0);
                SetGlobalVar(5,1);
            }else if(MarketPosition==-1) // Ó¿ղֵÄé
            {
                BuyToCover(1,0);
                SetGlobalVar(5,1);
            }
         //   Sell(0,Close);
         //   BuyToCover(0,Close);
        }
    }
*/
    
    PlotNumeric("Õ·ù", amp);
    PlotNumeric("È¾ù£º", iAmplitude);
    //PlotNumeric("³ɽ»£º", vol);

End

//------------------------------------------------------------------------
// ±à°汾 GS2010.12.08
// Ó»§°汾 2015-02-20 21:48:32
// °æËÓ q51394712
// ¸ü÷adeBlazer Software±£Á¶ÔradeBlazerƽ̨
//          ÿһ°汾µÄrabeBlazer¹«ʽÐ¸ĺÍØ´µÄ¨À
//------------------------------------------------------------------------
